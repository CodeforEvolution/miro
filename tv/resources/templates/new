<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
      eventCookie="@@@eventCookie@@@" dtvPlatform="@@@dtvPlatform@@@">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

    <link href="resource:css/main.css" rel="stylesheet" type="text/css" />
    <t:include filename="dynamic.js" />
    <t:include filename="settings.js" />
    <script type="text/javascript" src="resource:templates/shide.js" />
    <script type="text/javascript" src="resource:templates/osxdnd.js" />

    <t:execOnLoad><![CDATA[
global searchFilter
searchFilter = lambda x: filters.matchingItems(x, None)

allUnwatchedItems = views.items.filter(filters.unwatchedItems)
allExpiringItems = views.items.filter(filters.expiringItems)

matchingUnwatchedItems = allUnwatchedItems.filter(lambda x:searchFilter(x))
matchingExpiringItems = allExpiringItems.filter(lambda x:searchFilter(x))

unwatchedItems = matchingUnwatchedItems.sort(sorts.item)
expiringItems = matchingExpiringItems.sort(sorts.item)

def updateSearchString(newSearch):
    global searchFilter
    if len(newSearch) == 0:
        searchFilter = lambda x: filters.matchingItems(x, None)
    else:
        searchFilter = lambda x: filters.matchingItems(x, newSearch)
    allUnwatchedItems.recomputeFilter(matchingUnwatchedItems)
    allExpiringItems.recomputeFilter(matchingExpiringItems)

]]>
    </t:execOnLoad>
    <t:execOnUnload><![CDATA[
allUnwatchedItems.unlink()
allExpiringItems.unlink()
]]>
    </t:execOnUnload>

</head>

<body>

<!-- TITLE BAR ************************************************************ -->
<div id="main-titlebar">
	<div id="main-titlebar-avatar" class="noborder"><img src="resource:images/newvideos-icon.png" /></div>
	<div id="main-titlebar-channelname">
		<h1 i18n:translate="">New Videos</h1>
	</div>
	<div id="main-titlebar-tasks" class="big-search">
		<div id="main-titlebar-tasks-search">
		<input type="search" placeholder="Search Videos" class="main-titlebar-tasks-search"  onfocus="startEditSearch(this, null)" onblur="endEditSearch()" />
		</div>
	</div>
</div>
<!-- / TITLE BAR -->

<div id="main-container">

    <!-- UNWATCHED ******************************************************** -->
    <span t:hideIf="len(unwatchedItems) == 0" t:updateHideOnView="unwatchedItems">
        <div class="main-channelbar">
        <div class="main-channelbar-hitbox"><a href="javascript:toggleLayer('main-unwatched');">#&nbsp;</a></div>
	<div>
		<h1 i18n:translate="">
			<span t:replaceMarkup="len(unwatchedItems)" /> 13 unwatched
		</h1>
		</div>
        </div>

        <div id="main-unwatched">
            <span t:repeatForView="unwatchedItems">
                <span t:replaceMarkup="this.getItemXML(viewName)" />
            </span>
        </div>
    </span>
    <!-- / UNWATCHED -->

    <!-- EXPIRING ********************************************************* -->
    <span t:hideIf="len(expiringItems) == 0" t:updateHideOnView="expiringItems">
        <div class="main-channelbar-hitbox"><a href="javascript:toggleLayer('main-expiring');">#&nbsp;</a></div>
        <div id="main-channelbar" class="main-channelbar">
        	<h1 i18n:translate="">Expiring</h1>
        	<h2 t:updateForView="expiringItems"><span t:replace="len(expiringItems)" /></h2>
        </div>

        <div id="main-expiring">
            <span t:repeatForView="expiringItems">
                <span t:replaceMarkup="this.getItemXML(viewName)" />
            </span>
        </div>
    </span>
    <!-- / EXPIRING -->
	
</div>

</body>
</html>
