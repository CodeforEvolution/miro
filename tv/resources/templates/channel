<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
      eventCookie="@@@eventCookie@@@" dtvPlatform="@@@dtvPlatform@@@">

<head>
    <base href="***feed.getBaseHref()***" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Democracy Channel View</title>

    <link href="resource:css/main.css" rel="stylesheet" type="text/css" />
    <t:include filename="dynamic.js" />
    <t:include filename="settings.js" />
    <script type="text/javascript" src="resource:templates/osxdnd.js" />
    <script type="text/javascript" src="resource:templates/shide.js" />
    <script type="text/javascript" src="resource:templates/channel.js" />

    <t:execOnLoad><![CDATA[
feed = views.feeds.getObjectByID(int(kargs['id']))

global searchTerm
searchTerm = None

allItems = views.items.filterWithIndex(indexes.itemsByFeed, feed.getID())
matchingItems = allItems.filter(lambda x: filters.matchingItems(x, searchTerm))
matchingItems = matchingItems.sort(sorts.item)
downloadingItems = matchingItems.filter(filters.downloadingItems)
thisFeedView = views.feeds.filter(lambda x: x is feed)

matchingItems.createIndex(indexes.itemsByChannelCategory)
def makeStateView(cat):
    view = matchingItems.filterWithIndex(indexes.itemsByChannelCategory, cat)
    return view.sort(sorts.item)
newItems = makeStateView('new')
unwatchedItems = makeStateView('newly-downloaded')
expiringItems = makeStateView('expiring')
savedItems = makeStateView('saved')

if newItems.len() == unwatchedItems.len() == expiringItems.len() == savedItems.len() == 0:
    mainChannelbarAvailableDisplay = mainMatchingDisplay = "block"
    showMoreVideosDisplay = "none"
else:
    mainChannelbarAvailableDisplay = mainMatchingDisplay = "none"
    showMoreVideosDisplay = "block"

def updateSearchString(newSearch):
    global searchTerm
    if len(newSearch) == 0:
        searchTerm = None
    else:
        searchTerm = newSearch
    allItems.recomputeFilter(matchingItems)
feed.updateIcons()
]]>

channelNoun = _("Channel")
    </t:execOnLoad>
    <t:execOnUnload><![CDATA[
# This should unlink matchingItems and all of it's children
allItems.unlink()
thisFeedView.unlink()
if feed.idExists():
    feed.markAsViewed()
]]>
    </t:execOnUnload>

</head>

<body>
    
<!-- TITLE BAR ************************************************************ -->
<div id="main-titlebar">
        <img id="main-titlebar-avatar" src="***feed.getThumbnail()***" alt="" style="background-color:#FFFFFF;" />
	<div id="main-titlebar-channelname">
	    <div t:updateForView="thisFeedView">
                <h1 t:replaceMarkup="feed.getTitle()" />
                <div id="main-titlebar-autodownload">
		<form name="setAuto" >
		    <input type="hidden" name="feed" value="@@@feed.getID()@@@" />
		    <input type="checkbox" name="automatic" value="1" checked="checked" onClick="javascript:setAutoDownloadableFeed()" t:hideIf="not feed.isAutoDownloadable()" />
		    <input type="checkbox" name="automatic" value="1"                   onClick="javascript:setAutoDownloadableFeed()" t:hideIf="feed.isAutoDownloadable()" />
		    <span class="auto_link" i18n:translate="">Auto Download</span>
		</form>
                </div>
	    </div>
        </div>
        <div id="main-titlebar-tasks">
                <div id="main-titlebar-tasks-settings">
                        <p><a href="#" onclick="return eventURL('template:feed-settings?id=@@@feed.getID()@@@');"><span i18n:translate="">Settings</span></a></p>
                </div>
                <div id="main-titlebar-tasks-recommend">
                    <p><a href="mailto:?subject=@@@feed.getTitle()@@@&amp;body=%0D%0A%0D%0AYou should check out the Internet TV channel &quot;@@@feed.getTitle()@@@&quot;. If you don't have the Democracy Player, you can get it here:%0D%0A%0D%0Ahttp://www.getdemocracy.com/%0D%0A%0D%0AAnd then subscribe to this channel:%0D%0A%0D%0A@@@feed.getURL()@@@" class="recommend_link" i18n:translate="">Recommend</a></p>
                </div>
                <div id="main-titlebar-tasks-search">
                    <input type="search" placeholder="Search Channel" class="main-titlebar-tasks-search" onfocus="startEditSearch(this, showAllVideos)" onblur="endEditSearch()" />
                </div>
        </div>
</div>
<!-- / TITLE BAR -->
<!-- CHANNEL CONTAINER **************************************************** -->
<div id="main-container">
    <div class="main-container-scraping" t:showIf="feed.isScraped() and feed.isUpdating()" t:updateHideOnView="thisFeedView">
    <div class="scraping-indicator">
      <img align="left" src="resource:images/scraping-indicator-left.gif" />
      <img align="right" src="resource:images/scraping-indicator-right.gif" />
      <div class="scraping-content" i18n:translate="">Looking for videos 
      at this URL</div>
    </div>
    </div>
    <t:includeTemplate filename="channel-content" />
</div>
<!-- / CHANNEL ITEMS LIST -->

</body>
</html>
