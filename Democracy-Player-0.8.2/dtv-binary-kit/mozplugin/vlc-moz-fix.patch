Index: src/misc/modules.c
===================================================================
--- src/misc/modules.c	(revision 14085)
+++ src/misc/modules.c	(working copy)
@@ -2129,7 +2129,7 @@
     {
         /* Code int size, pointer size and endianness in the filename */
         int32_t x = 0xbe00001e;
-        sprintf( psz_cachename, "plugins-%.2x%.2x%.2x.dat", sizeof(int),
+        sprintf( psz_cachename, "pcfplugins-%.2x%.2x%.2x.dat", sizeof(int),
                  sizeof(void *), (unsigned int)((unsigned char *)&x)[0] );
         b_initialised = VLC_TRUE;
     }
Index: include/vlc_config.h
===================================================================
--- include/vlc_config.h	(revision 14085)
+++ include/vlc_config.h	(working copy)
@@ -50,7 +50,7 @@
 #elif SYS_DARWIN
 #  define CONFIG_DIR                    "Library/Preferences/VLC"
 #elif defined( WIN32 ) || defined( UNDER_CE )
-#  define CONFIG_DIR                    "vlc"
+#  define CONFIG_DIR                    "PCF-VLC"
 #else
 #  define CONFIG_DIR                    ".vlc"
 #endif
Index: mozilla/vlcshell.cpp
===================================================================
--- mozilla/vlcshell.cpp	(revision 14085)
+++ mozilla/vlcshell.cpp	(working copy)
@@ -32,6 +32,7 @@
 #include <stdio.h>
 #include <string.h>
 #include <stdlib.h>
+#include <direct.h> /* _getcwd */
 
 /* vlc stuff */
 #ifdef USE_LIBVLC
@@ -303,27 +304,25 @@
         ppsz_argv[2] = plugin_path;
 
 #elif defined(XP_WIN)
-        char *ppsz_argv[] = { NULL, "-vv" };
-        HKEY h_key;
-        DWORD i_type, i_data = MAX_PATH + 1;
+        char *ppsz_argv[] = { NULL, "-vv","--plugin-path", NULL, "--config", NULL };
         char p_data[MAX_PATH + 1];
-        if( RegOpenKeyEx( HKEY_LOCAL_MACHINE, "Software\\VideoLAN\\VLC",
-                          0, KEY_READ, &h_key ) == ERROR_SUCCESS )
-        {
-             if( RegQueryValueEx( h_key, "InstallDir", 0, &i_type,
-                                  (LPBYTE)p_data, &i_data ) == ERROR_SUCCESS )
-             {
-                 if( i_type == REG_SZ )
-                 {
-                     strcat( p_data, "\\vlc" );
-                     ppsz_argv[0] = p_data;
-                 }
-             }
-             RegCloseKey( h_key );
-        }
-
         if( !ppsz_argv[0] ) ppsz_argv[0] = "vlc";
 
+        /* Set plugin path relative to the current working directory */
+        if (_getcwd(p_data, MAX_PATH) == NULL) {
+          ppsz_argv[3] = "vlc-plugins";
+        } else {
+
+          strcat(p_data, "\\vlc");
+          ppsz_argv[0] = strdup(p_data);
+          _getcwd(p_data, MAX_PATH);
+          strcat(p_data, "\\vlc-plugins");
+          ppsz_argv[3] = strdup(p_data);
+          _getcwd(p_data, MAX_PATH);
+          strcat(p_data, "\\vlcrc");
+          ppsz_argv[5] = strdup(p_data);
+        }
+
 #else /* XP_MACOSX */
         char *ppsz_argv[] =
         {
@@ -685,7 +684,7 @@
         {
 #if USE_LIBVLC
             VLC_AddTarget( p_plugin->i_vlc, p_plugin->psz_target,
-                           0, 0, PLAYLIST_INSERT, 0 );
+                           0, 0, i_mode, PLAYLIST_END );
 #endif
             p_plugin->b_stream = VLC_TRUE;
         }
